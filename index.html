<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, user-scalable=no,
		shrink-to-fit=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

	<title>iBeacon Scan</title>

	<style>
		@import 'ui/css/evothings-app.css';
	</style>
     <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.min.css"/>
     <link rel="stylesheet" type="text/css" href="css/jquery.mobile.icons.min.css"/>
	<script>
	// Redirect console.log to Evothings Workbench.
	if (window.hyper && window.hyper.log) { console.log = hyper.log }
	</script>
	<script src="cordova.js"></script>
	<script src="libs/jquery/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
	<script src="libs/evothings/evothings.js"></script>
	<script src="libs/evothings/ui/ui.js"></script>
	<script src="app.js"></script>
    <script type="text/javascript" src="js/dati.js"></script>

</head>

<body>
	 <div data-role="page" id="home" >
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Beacon Scan</h1>
        <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
         <div class="ui-grid-solo ui-responsive">
             <div class="noBeacon">
             <p class="testo">Spiegazione di cosa fa l ' applicazione</p>
             <p class="testo"><b>Avvicinati ad un Beacon </b></p>
             </div>
             <div class="LoginUtente">
                    
             </div>
            
          <ul id="found-beacons" class="dynamic"></ul>
        </div>
        <div data-role="popup" id="popupCloseLeft" class="ui-content" style="max-width:280px">
            <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-left">Close</a>
            <p style="font-size:20px;">Sto guardando la notizia</p>
        </div>
            <a href="#popupCloseLeft" data-rel="popup" style="display:none;" id="pop" data-position-to="window" class="ui-btn ui-corner-all ui-shadow ui-btn-inline">Left close button</a>
            <div data-role="popup" id="popupCloseDue" class="ui-content" style="max-width:280px">
            <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-left">Close</a>
            <p style="font-size:20px;">Sto salvando la notizia</p>
        </div>
            <a href="#popupCloseDue" data-rel="popup" style="display:none;" id="popDue" data-position-to="window" class="ui-btn ui-corner-all ui-shadow ui-btn-inline">Left close button</a>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Notifiche</a></li>
                     <li id="Login" ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                </ul>
            </div>
        </div>
    </div>
	 <div data-role="page" id="database" >
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Notifiche Salvate</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>

        <div role="main" class="ui-content">
        <div class="LoginUtente">
                    
         </div>
         <div class="ui-grid-solo ui-responsive">
            <ul data-role="listview" id="lista_datiJson" data-split-theme="a" data-split-icon="delete" data-inset="true"></ul>
        </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Notifiche</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                </ul>
            </div>
        </div>
    </div>
     <div data-role="page" id="login">
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Login</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
            <h3 class="titoliForm">Login Form </h3>
               <form id="loginSincro">
                    <label for="nome">Username:</label>
                        <input data-clear-btn="true" name="usernameLogin" id="usernameLogin" value="" type="text">
                    <label for="cognome">Password:</label>
                        <input data-clear-btn="true" name="passLogin" id="passLogin" value="" type="password">
                </form>
                <hr>
                <div>
                      <h3 class="iscrizione"><a href="#iscrizione"  data-transition="slide">Iscriviti</a></h3>
                </div>
                <div>
                    <button type="submit" class="ui-btn" id="loginUtente">Login</button>
                </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Notifiche</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div data-role="page" id="iscrizione">
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Registrazione</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
            <h3 class="titoliForm">Form di Registrazione </h3>
               <form id="registrazioneSincro">
                    <label for="nome">Nome:</label>
                        <input data-clear-btn="true" name="nome" id="nome" value="" type="text">
                    <label for="cognome">Cognome:</label>
                        <input data-clear-btn="true" name="cognome" id="cognome" value="" type="text">
                    <label for="email">E-mail:</label>
                        <input data-clear-btn="true" name="email" id="email" value="" type="text">
                    <label for="lnascita">Luogo nascita</label>
                        <input data-clear-btn="true" name="lnascita" id="lnascita" value="" type="text">
                    <label for="dataNascita">Data Nascita</label>
                        <input data-clear-btn="true" name="dataNascita" id="dataNascita" value="" type="date">   
                    <label for="citta">Città Residenza</label>
                        <input data-clear-btn="true" name="citta" id="citta" value="" type="text">   
                    <label for="username">Username</label>
                        <input data-clear-btn="true" name="username" id="username" value="" type="text"> 
                    <label for="pass">Password</label>
                        <input data-clear-btn="true" name="pass" id="pass" value="" type="password">    
                    <hr>
                      <b class="margine">Acconsento Privacy</b>   <input type="checkbox" name="privacy" id="privacy" value="html"/> 
                </form>
                <hr>
                <div>
                    <button type="submit" class="ui-btn" id="iscriviUtente">Registrati</button>
                </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Database</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                </ul>
            </div>
        </div>
    </div>
     <div data-role="page" id="dettaglioNotifica" >
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Notifica</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
         <div class="schedaNotifica">

         </div>
                <div>
                    <button type="submit" class="ui-btn" id="cancellaNotifica">Cancella Notifica</button>
                </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Notifiche</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                </ul>
            </div>
        </div>
    </div>
  
<script>

     
 $(document).on("pagebeforeshow", "#home", function () {
     
      var p = localStorage.getItem('login');
     //alert(p);
	 if(p=='true')
     {
         //alert("entra");
         $('.LoginUtente').html("");
         var benvenuto = "<h2>Benvenuto "+localStorage.getItem('usernameLoginApp')+"</h2>";
         $('.LoginUtente').append(benvenuto);
         $('.LoginUtente').addClass("benvenuto_utente");
         $('.LogoutUtente').css("display","block");
         $('.button_logout').css("float","right");
     }
    });

    $(document).on("pagebeforeshow", "#database", function () {
     var p = localStorage.getItem('login');
	 if(p=='true')
     {
         $('.LoginUtente').html("");
         var benvenuto = "<h2>Benvenuto "+localStorage.getItem('usernameLoginApp')+"</h2>";
         $('.LoginUtente').append(benvenuto);
         $('.LoginUtente').addClass("benvenuto_utente");
     }
    });

 $(document).on("pagebeforeshow", "#iscrizione", function () {
      $(':text, :password, :date', '#registrazioneSincro').val(''); 
    });	 
/*function alertDismissed() {
 alert("Partito");
}*/
 
   $(document).on("pageinit", "#database", function () {
    /*  alert("ok");
       $("#lista_datiJson").html("");
       caricoDatiServerSalvoInDb ();*/
    });
	 $(document).on("pagebeforeshow", "#database", function () {
		// alert("ok");
         $("#lista_datiJson").html("");
         selezionoDati ();
    });

     $(document).on("pagebeforeshow", "#dettaglioNotifica", function () {
          var idgiusto = localStorage.getItem('Id_notifica');
      alert("Session "+ idgiusto);
      db = window.openDatabase("DatabaseSqlliteApp", "1.0", "Database prova", 200000);
				db.transaction(
					function(tx)
					{
               			tx.executeSql("SELECT * FROM notifiche WHERE ID_notizia = ? ",[idgiusto], 
			   			function(tx,dati)
			   			{
				 			var len = dati.rows.length;
        					var datiNot="";
       						if(len!=0)
        					{
								
                 datiNot +="<h1>"+ dati.rows.item(0).titolo+"</h1>;
                    $(".schedaNotifica").append(datiNot);
			    				//alert("ID_notiiza"+ID_notizia);
        			       }
			   		    },
                        function{
                        alert("Errore selezione");
                        }); 
 				});
  
        
     });
 
     $('#iscriviUtente').click(function(){
      /*   var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,"n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}*/
     
     // alert("Partito");
      var privacy;
      if ($('#privacy').is(":checked"))
      {
         privacy=1
      }else{
         privacy=0
      }
      var nome = $("#nome").val();
      var cognome = $("#cognome").val();
      var email = $("#email").val();
      var luogoN = $("#lnascita").val();
      var dataN = $("#dataNascita").val();
      var citta = $("#citta").val();
      var username = $("#username").val();
      var password = $("#pass").val();
    /*  var passwordCodficata = Base64.encode(password);
    alert(passwordCodficata);
     /* var decodifca =  Base64.decode(passwordCodficata);
      alert(decodifca);*/
      aggiungiUtente(nome,cognome,email,luogoN,dataN,citta,username,password,privacy);
      });
    $('#loginUtente').click(function(){
     
      alert("Partito");
      var usernameLogin = $("#usernameLogin").val();
      var passLogin = $("#passLogin").val();
      loginUtente(usernameLogin,passLogin);     
     // aggiungiUtente(nome,cognome,email,luogoN,dataN,citta,username,password,privacy);
      });

    $('.button_logout').click(function(){
        alert("entra");
          localStorage.setItem('login', false);
          window.location.href = "index.html";
      });


// popolo la notifica   
function visualizzoNotifica ()
{
     
}

</script>
<!--	<header>
		<button class="back" onclick="history.back()">
			<img src="ui/images/arrow-left.svg" />
		</button>

		<img class="logotype" src="ui/images/logo.svg" alt="Evothings" />

		<!--<button class="menu" onclick=""><img src="ui/images/menu.svg" /></button>
	</header>

	<h1>iBeacon Scan</h1>
	<p id="warning">To detect iBeacons you will have to add the 128bit UUID's you
	are looking for to the regions array in app.js of the iBeacon example.
	</p>
	<ul id="found-beacons" class="dynamic"></ul>-->

</body>

</html>
