<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, user-scalable=no,
		shrink-to-fit=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

	<title>iBeacon Scan</title>

	<style>
		@import 'ui/css/evothings-app.css';
	</style>
     <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.min.css"/>
     <link rel="stylesheet" type="text/css" href="css/jquery.mobile.icons.min.css"/>

  
	<script>
	// Redirect console.log to Evothings Workbench.
	if (window.hyper && window.hyper.log) { console.log = hyper.log }
	</script>
	<script src="cordova.js"></script>
	<script src="libs/jquery/jquery.js"></script>
	<script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/javascript" src="js/jquery.validate.min.js"></script>
	<script src="libs/evothings/evothings.js"></script>
	<script src="libs/evothings/ui/ui.js"></script>
	<script src="app.js"></script>
    <script type="text/javascript" src="js/dati.js"></script>

    
</head>

<body>


	 <div  data-role="page" id="home" class="container_page" >
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Beacon Scan</h1>
        <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
         <div class="ui-grid-solo ui-responsive">
             <div class="noBeacon">
             <p class="testo">Spiegazione di cosa fa l ' applicazione</p>
             <p class="testo"><b>Avvicinati ad un Beacon </b></p>
             </div>
             <div class="LoginUtente">
                    
             </div>
            
          <ul id="found-beacons" class="dynamic"></ul>
        </div>
        <div data-role="popup" class="popupNotifica" class="ui-content" style="max-width:280px">
            <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-left">Close</a>
            <p style="font-size:20px;">Sto guardando la notizia</p>
        </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Notifiche</a></li>
                    <li id="Login" ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                    <li ><a href="#infoMvitalia" data-icon="info"   data-transition="slide">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
	 <div data-role="page" id="database" >
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Notifiche Salvate</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>

        <div role="main" class="ui-content">
        <div class="LoginUtente">
                    
         </div>
         <div class="ui-grid-solo ui-responsive">
            <ul data-role="listview" id="lista_datiJson" data-split-theme="a" data-split-icon="delete" data-inset="true"></ul>
            <div data-role="popup" id="purchase" data-theme="a" data-overlay-theme="b" class="ui-content" style="max-width:340px; padding-bottom:2em;">
                <h3>Sei sicuro di volre cancellare le notifica?</h3>
                    <p>Se confermi la notifica verrà cancellata dalla memoria del dispositivo.</p>
                    <div class="ui-block-a"><a href="#" id="cancellaNot" class="ui-btn ui-shadow ui-corner-all">SI</a></div>
                    <div class="ui-block-b"><a href="#" id="noCancellanot" class="ui-btn ui-shadow ui-corner-all">NO</a></div>
            </div>
        </div>
        <div>
             <button type="submit" class="ui-btn" id="cancellaTutteNotifiche">Cancella Tutto</button> 
        </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Notifiche</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                    <li ><a href="#infoMvitalia" data-icon="info"   data-transition="slide">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
     <div data-role="page" id="login">
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Login</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
            <h3 class="titoliForm">Login Form </h3>
               <form id="loginSincro">
                    <label for="nome">Username:</label>
                        <input data-clear-btn="true" name="usernameLogin" id="usernameLogin" value="" type="text">
                    <label for="cognome">Password:</label>
                        <input data-clear-btn="true" name="passLogin" id="passLogin" value="" type="password">
                <div>
                       <input type="submit"  class="ui-btn" value="Login" id="submit">
                 
                </div>
                  </form>
                 <hr>
                 <div> 
                     <div style="text-align:center; margin-bottom:15px;" >  <a class="link_reg_pass"  href="#lostPassword"  data-transition="slide">Password dimenticata?</a> </div>   
                     <div style="text-align:center" >  <a class="link_reg_pass" href="#registrazione"  data-transition="slide">Iscriviti</a> </div>
                    
                </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Notifiche</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                    <li ><a href="#infoMvitalia" data-icon="info"   data-transition="slide">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div data-role="page" id="registrazione">
        <div data-role="header" class="header" data-position="fixed">
            <h1 id="app-title">Registrazione</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
             <h3 class="titoliForm">Form di Registrazione </h3>
               <form id="registrazioneSincro">
                    <label for="nome">Nome:</label>
                        <input data-clear-btn="true" name="nome" id="nome" value="" type="text">
                    <label for="cognome">Cognome:</label>
                        <input data-clear-btn="true" name="cognome" id="cognome" value="" type="text">
                    <label for="email">E-mail:</label>
                        <input data-clear-btn="true" name="email" id="email" value="" type="text">
                    <label for="lnascita">Luogo nascita</label>
                        <input data-clear-btn="true" name="lnascita" id="lnascita" value="" type="text">
                    <label for="dataNascita">Data Nascita</label>
                        <input data-clear-btn="true" name="dataNascita" id="dataNascita" value="" type="date">   
                    <label for="citta">Città Residenza</label>
                        <input data-clear-btn="true" name="citta" id="citta" value="" type="text">   
                    <label for="username">Username</label>
                        <input data-clear-btn="true" name="username" id="username" value="" type="text"> 
                    <label for="pass">Password</label>
                        <input data-clear-btn="true" name="pass" id="pass" value="" type="password">    
                    <hr>
                     <div class="box_privacy">
                        <h3>Privacy</h3>
                        <p>Per avere ulteriori informazioni completa il modulo online con i tuoi dati (che saranno utilizzati esclusivamente per soddisfare la tua richiesta, nel più assoluto rispetto della privacy).</p>
                        <p>Per maggiori informazioni clicca qui </p>
                    </div>
                      <b class="margine">Acconsento Privacy</b>   <input type="checkbox" name="privacy" id="privacy" value="html"/> 
              
                <hr>
                <div>
                    <input type="submit"  class="ui-btn" value="Invia" id="submit">
                </div>
                  </form>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Database</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                    <li ><a href="#infoMvitalia" data-icon="info"   data-transition="slide">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
   <div data-role="page" id="inviaInfo">
        <div data-role="header" class="header" data-position="fixed">
            <h1>Informazioni</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
           <h3 class="titoliForm">Invia Info </h3>
               <form id="inviaInfoNotifica">
                    <label for="nome">Nome:</label>
                        <input data-clear-btn="true" name="nomeInfo" id="nomeInfo" required value="" type="text">
                    <label for="cognome">Cognome:</label>
                        <input data-clear-btn="true" name="cognomeInfo" id="cognomeInfo" required value="" type="text">
                    <label for="email">E-mail:</label>
                        <input data-clear-btn="true" name="emailInfo" id="emailInfo" required value="" type="text">
                    <label for="lnascita">Richiesta</label>
                        <textarea data-clear-btn="true" name="richiestaInfo" id="richiestaInfo" rows="5" > 
                        </textarea>
                    <hr>
                    <div class="box_privacy">
                        <h3>Privacy</h3>
                        <p>Per avere ulteriori informazioni completa il modulo online con i tuoi dati (che saranno utilizzati esclusivamente per soddisfare la tua richiesta, nel più assoluto rispetto della privacy).</p>
                        <p>Per maggiori informazioni clicca qui </p>
                    </div>
                      <b class="margine">Acconsento Privacy</b>   <input type="checkbox" required name="privacyInfo" id="privacyInfo" value="html"/> 
                
                <hr>
                <div>
                    <input type="submit"  class="ui-btn" value="Invia" id="submit">
                </div>
                </form>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Database</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                    <li ><a href="#infoMvitalia" data-icon="info"   data-transition="slide">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
     <div data-role="page" id="infoMvitalia">
        <div data-role="header" class="header" data-position="fixed">
            <h1>Mvitalia</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
             <div class="wrapper_logo">
                  <img class="logo_mv" src="img/logo_mvitalia.png"/>  
            </div>
               <p>Richiedi informazioni tecniche</p>
               <hr>
                <form id="inviaInfoMv">
                    <label for="nome">Nome:</label>
                        <input data-clear-btn="true" name="nomeMv" id="nomeMv" value="" type="text">
                    <label for="cognome">Cognome:</label>
                        <input data-clear-btn="true" name="cognomeMv" id="cognomeMv" value="" type="text">
                    <label for="email">E-mail:</label>
                        <input data-clear-btn="true" name="emailMv" id="emailMv" value="" type="text">
                    <label for="lnascita">Richiesta Informazione</label>
                        <textarea  name="richiestaMv" id="richiestaMv" rows="5" > </textarea>
                    <hr>
                     <div class="box_privacy">
                        <h3>Privacy</h3>
                        <p>Per avere ulteriori informazioni completa il modulo online con i tuoi dati (che saranno utilizzati esclusivamente per soddisfare la tua richiesta, nel più assoluto rispetto della privacy).</p>
                        <p>Per maggiori informazioni clicca qui </p>
                    </div>
                      <b class="margine">Acconsento Privacy</b>   <input type="checkbox" name="privacyMv" id="privacyMv" value="html"/> 
               
                 <div>
                    <input type="submit"  class="ui-btn" value="Invia" id="submit">
                </div>
                 </form>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Database</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                    <li ><a href="#infoMvitalia" data-icon="info"   data-transition="slide">Info</a></li>
                </ul>
            </div>
        </div>
    </div>
      <div data-role="page" id="lostPassword">
        <div data-role="header" class="header" data-position="fixed" data-add-back-btn="true">
            <h1 id="app-title">Password Dimenticata</h1>
             <div class="wrapper">
            <img class="logoApp" src="img/search.jpg"/>    
        </div>
         <div class="LogoutUtente">
                <a class="button_logout" href="#home" data-role="button" data-mini="true" data-icon="action" data-iconpos="right">Logout</a>
        </div>
        </div>
        <div role="main" class="ui-content">
            <h3 class="titoliForm">Recupero Password Form </h3>
               <form id="recuperoPass">
                    <label for="nome">Email:</label>
                        <input data-clear-btn="true" name="emailRecuperoPass" id="emailRecuperoPass" value="" placeholder="Inserire la propria E-mail" type="text">
                   
                <div>
                       <input type="submit"  class="ui-btn" value="Login" id="submit">
                 
                </div>
                  </form>
        </div>
        <div data-role="footer" data-position="fixed">
            <!--Tab bar jquery mobile-->
            <div data-role="navbar" data-iconpos="top">
                 <ul>
                    <li><a href="#home" data-icon="home"  data-transition="slide">Home</a></li>
                    <li ><a href="#database" data-icon="eye"   data-transition="slide">Notifiche</a></li>
                     <li ><a href="#login" data-icon="user"   data-transition="slide">Login</a></li>
                    <li ><a href="#infoMvitalia" data-icon="info"   data-transition="slide">Info</a></li>
                       <li ><a href="#mappa" data-icon="location"   data-transition="slide">Info</a></li>
                </ul>
            </div>
        </div>
    </div> 
  
<script>

     
 $(document).on("pagebeforeshow", "#home", function () {
     
      var p = localStorage.getItem('login');
     //alert(p);
	 if(p=='true')
     {
         //alert("entra");
         $('.LoginUtente').html("");
         var benvenuto = "<h2>Benvenuto "+localStorage.getItem('usernameLoginApp')+"</h2>";
         $('.LoginUtente').append(benvenuto);
         $('.LoginUtente').addClass("benvenuto_utente");
         $('.LogoutUtente').css("display","block");
         $('.button_logout').css("float","right");
     }else{
       //  selezionoDati ();
     }
    });

    $(document).on("pagebeforeshow", "#database", function () {
     var p = localStorage.getItem('login');
	 if(p=='true')
     {
         $('.LoginUtente').html("");
         var benvenuto = "<h2>Benvenuto "+localStorage.getItem('usernameLoginApp')+"</h2>";
         $('.LoginUtente').append(benvenuto);
         $('.LoginUtente').addClass("benvenuto_utente");
     }
    });

 $(document).on("pagebeforeshow", "#registrazione", function () {
    /*  $(':text, :password, :date', '#registrazioneSincro').val(''); 
    });*/	 
/*function alertDismissed() {
 alert("Partito");*/
});
 
   $(document).on("pageinit", "#database", function () {
    /*  alert("ok");
       $("#lista_datiJson").html("");
       caricoDatiServerSalvoInDb ();*/
    });
	 $(document).on("pagebeforeshow", "#database", function () {
		// alert("ok");
         $("#lista_datiJson").html("");
         selezionoDati ();
    });

     $(document).on("pageshow", "#Notifica", function () {
           $(".schedaNotifica").html("");
     caricaNotifica(); 
     });


    // Validazione e registrazione utente
$('#registrazioneSincro').validate({
    rules: {
        nome: {
            required: true
        },
        cognome: {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        lnascita: {
            required: true
        },
        dataNascita: {
            required: true
        },
        citta: {
            required: true
        },
        username: {
            required: true
        },
        pass: {
            required: true
        },
         privacy: {
            required: true
        }
    },
    messages: {
        nome: {
            required: "Inserire il nome."
        },
        cognome: {
            required: "Inserire il cognome."
        },
        email: {
            required: "Inserire l' E-mail.",
            email:"Prego inserire un E-mail corretta"
        },
         lnascita: {
            required: "Inserire luogo di nascita"
        },
         dataNascita: {
            required: "Inserire la data di nascita"
        },
         citta: {
            required: "Inserire residenza"
        },
         username: {
            required: "Inserire username"
        },
         pass: {
            required: "Inserire password"
        },
        privacy: {
            required: "Acconsenti privacy."
        }
    },
    errorPlacement: function (error, element) {
        error.appendTo(element.parent().prev());
    },
    submitHandler: function (form) {
     var privacy;
      if ($('#privacy').is(":checked"))
      {
         privacy=1
      }else{
         privacy=0
      }
      var nome = $("#nome").val();
      var cognome = $("#cognome").val();
      var email = $("#email").val();
      var luogoN = $("#lnascita").val();
      var dataN = $("#dataNascita").val();
      var citta = $("#citta").val();
      var username = $("#username").val();
      var password = $("#pass").val();
      aggiungiUtente(nome,cognome,email,luogoN,dataN,citta,username,password,privacy);
      return false;
    }
});


// Validate del form login 
$('#loginSincro').validate({
    rules: {
        usernameLogin: {
            required: true
        },
        passLogin: {
            required: true
        }
    },
    messages: {
        usernameLogin: {
            required: "Inserire ilusername."
        },
        passLogin: {
            required: "Inserire password."
        }
    },
    errorPlacement: function (error, element) {
        error.appendTo(element.parent().prev());
    },
    submitHandler: function (form) {
     var usernameLogin = $("#usernameLogin").val();
      var passLogin = $("#passLogin").val();
      loginUtente(usernameLogin,passLogin);  
      return false;
    }
});

// Validate del form recupero password
$('#recuperoPass').validate({
    rules: {
        emailRecuperoPass: {
            required: true,
            email: true
        }
    },
    messages: {
        usernameLogin: {
            required: "Inserire E-mail",
            email: "Inserire un E-mail valida"
        }
    },
    errorPlacement: function (error, element) {
        error.appendTo(element.parent().prev());
    },
    submitHandler: function (form) {
     var emailRecuperoPass = $("#emailRecuperoPass").val();
     recuperoPassword(emailRecuperoPass);  
     return false;
    }
});


    $('.button_logout').click(function(){
        alert("entra");
       // localStorage.removeItem("login");
          localStorage.setItem('login', false);
          localStorage.removeItem("Id_login");
        //  $('.button_logout').css("display","none");
          window.location.href = "index.html";
      });


// popolo la notifica   
function visualizzoNotifica ()
{
     
}

 $(document).on("click", ".storage", function () {
     var id = $(this).parents("li").attr("id");
     alert(id);
     sessionStorage.setItem('ID_not', id);
});



$(document).on("click", ".detail", function () {
     var id = $(this).parents("li").data("itemid");
     localStorage.removeItem("Id_notifica");
     localStorage.setItem('Id_notifica', id);
     $( ":mobile-pagecontainer" ).pagecontainer( "change", "notifica.html", {    transition: "flip", reload:true } );
     
});

$('#cancellaNot').click(function(){
        alert("entra");
      cancellaNotifica ();
      });

$('#noCancellanot').click(function(){
        $("#purchase").popup( "close" );
});

$('#cancellaTutteNotifiche').click(function(){
       cancellaAllNotifiche();
});


/*$(document).on("click", ".SalvaNotifica", function () {
     var id = $(this).parents("div").data("itemid");
    $('.'+id+'').hide();
});

$(document).on("click", ".ApriNotifica", function () {
     var id = $(this).parents("div").data("itemid");
     localStorage.setItem('Id_notifica', id);
       $('.'+id+'').hide();
    $( ":mobile-pagecontainer" ).pagecontainer( "change", "notifica.html", {    transition: "flip", reload:true } );

});*/

// Validazione e invio email per l' informazione della notifica

$('#inviaInfoNotifica').validate({
    rules: {
        nomeInfo: {
            required: true
        },
        cognomeInfo: {
            required: true
        },
        emailInfo: {
            required: true,
            email: true
        },
        richiestaInfo: {
            required: true
        },
         privacyInfo: {
            required: true
        }
    },
    messages: {
        nomeInfo: {
            required: "Inserire il nome."
        },
        cognomeInfo: {
            required: "Inserire il cognome."
        },
        emailInfo: {
            required: "Inserire l' E-mail.",
            email:"Prego inserire un E-mail corretta"
        },
        richiestaInfo: {
            required: "Inserire la richiesta."
        },
        privacyInfo: {
            required: "Acconsenti privacy."
        }
    },
    errorPlacement: function (error, element) {
        error.appendTo(element.parent().prev());
    },
    submitHandler: function (form) {
     var pInfo
     if ($('#privacyInfo').is(":checked"))
      {
         pInfo=1
      }else{
         pInfo=0
      }
      var nInfo = $("#nomeInfo").val();
      var cInfo = $("#cognomeInfo").val();
      var eInfo = $("#emailInfo").val();
      var rInfo = $("#richiestaInfo").val();
     inviaInformazione(pInfo,nInfo,cInfo,eInfo,rInfo);
        return false;
    }
});

// Validazione e invio email Mvitalia

$('#inviaInfoMv').validate({
    rules: {
        nomeMv: {
            required: true
        },
        cognomeMv: {
            required: true
        },
        emailMv: {
            required: true,
            email: true
        },
         privacyMv: {
            required: true
        }
    },
    messages: {
        nomeMv: {
            required: "Inserire il nome."
        },
        cognomeMv: {
            required: "Inserire il cognome."
        },
        emailMv: {
            required: "Inserire l' E-mail.",
            email:"Prego inserire un E-mail corretta"
        },
        privacyMv: {
            required: "Acconsenti privacy."
        }
    },
    errorPlacement: function (error, element) {
        error.appendTo(element.parent().prev());
    },
    submitHandler: function (form) {
     var pMv
     if ($('#privacyMv').is(":checked"))
      {
         pMv=1
      }else{
         pMv=0
      }
      var nMv = $("#nomeMv").val();
      var cMv = $("#cognomeMv").val();
      var eMv = $("#emailMv").val();
      var rMv = $("#richiestaMv").val();
      inviaInformazioneMv(pMv,nMv,cMv,eMv,rMv);
        return false;
    }
});

</script>

</body>

</html>
